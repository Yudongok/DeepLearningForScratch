{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "795de6d5-51b2-40b4-b240-3f313f2a7fc7",
   "metadata": {},
   "source": [
    "# CNN ë„¤íŠ¸ì›Œí¬ êµ¬ì¡°\n",
    "\n",
    "![image.png](attachment:7aed6d0b-9652-4c2d-9097-50f71ca4687c:image.png)\n",
    "\n",
    "- ê¸°ì¡´ Affine-ReLUì—°ê²° ë°©ì‹ì´ Conv-ReLU-Poolingìœ¼ë¡œ ë³€ê²½\n",
    "- ì¶œë ¥ì— ê°€ê¹Œìš´ ì¸µì—ì„  Affine-ReLUêµ¬ì„±\n",
    "- ë§ˆì§€ë§‰ ì¶œë ¥ê³„ì¸µì€ Affine-Softmax\n",
    "\n",
    "**CNN**ì€ ë³´í†µ 'ì»¨ë³¼ë£¨ì…˜-í’€ë§' ê³„ì¸µë“¤ê³¼ 'ì™„ì „ ì—°ê²°' ê³„ì¸µë“¤ì˜ ì¡°í•©ìœ¼ë¡œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.\n",
    "\n",
    "1. **ì»¨ë³¼ë£¨ì…˜ ê³„ì¸µ (Convolutional Layer)**\n",
    "    - ì…ë ¥ìœ¼ë¡œ 3ì°¨ì› ë°ì´í„°(ì±„ë„, ë†’ì´, ë„ˆë¹„)ë¥¼ ë°›ëŠ”ë‹¤.\n",
    "    - í•„í„° ì—°ì‚°ì„ í†µí•´ **íŠ¹ì§• ë§µ(Feature Map)**ì´ë¼ëŠ” 3ì°¨ì› ë°ì´í„°ë¥¼ ì¶œë ¥í•œë‹¤.\n",
    "    - ì½”ë“œì˜ `conv_output_size`ëŠ” ì´ íŠ¹ì§• ë§µì˜ ë†’ì´ì™€ ë„ˆë¹„ í¬ê¸°ë¥¼ ê³„ì‚°í•˜ëŠ” ë¶€ë¶„ì´ë‹¤.\n",
    "    `(input_size - filter_size + 2*filter_pad) / filter_stride + 1` ê³µì‹ì— ë”°ë¼ ê³„ì‚°ë˜ì£ .\n",
    "2. **í’€ë§ ê³„ì¸µ (Pooling Layer)**\n",
    "    - ì»¨ë³¼ë£¨ì…˜ ê³„ì¸µì—ì„œ ë‚˜ì˜¨ íŠ¹ì§• ë§µì˜ í¬ê¸°ë¥¼ ì¤„ì—¬(sub-sampling) ì—°ì‚°ëŸ‰ì„ ê°ì†Œì‹œí‚¤ê³  ì£¼ìš” íŠ¹ì§•ì„ ê°•ì¡°í•œë‹¤.\n",
    "    - ì½”ë“œì—ì„œëŠ” `conv_output_size/2`ë¥¼ í†µí•´ í’€ë§(ì•„ë§ˆë„ 2x2 í’€ë§) í›„ì˜ í¬ê¸°ë¥¼ ì•”ì‹œí•˜ê³  ìˆë‹¤.\n",
    "3. **ì™„ì „ ì—°ê²° ê³„ì¸µ (Fully-Connected Layer, Affine Layer)**\n",
    "    - ë¶„ë¥˜ì™€ ê°™ì€ ìµœì¢… ì‘ì—…ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ ì‚¬ìš©ëœë‹¤.\n",
    "    - í•˜ì§€ë§Œ ì´ ê³„ì¸µì€ 1ì°¨ì› ë°°ì—´ í˜•íƒœì˜ ë°ì´í„°ë§Œ ì…ë ¥ìœ¼ë¡œ ë°›ì„ ìˆ˜ ìˆë‹¤.\n",
    "\n",
    "# CNNìš©ì–´\n",
    "\n",
    "- íŠ¹ì§• ë§µ: í•©ì„±ê³± ê³„ì¸µì˜ ì…ì¶œë ¥ ë°ì´í„°\n",
    "- í•©ì„±ê³± ì—°ì‚°: ì´ë¯¸ì§€ ì²˜ë¦¬ì—ì„œ ë§í•˜ëŠ” í•„í„° ì—°ì‚°ì— í•´ë‹¹í•œë‹¤.\n",
    "- íŒ¨ë”©(Padding): ì…ë ¥ë°ì´í„° ì£¼ë³€ì„ íŠ¹ì •ê°’(0)ìœ¼ë¡œ ì±„ì›€ â†’ ì£¼ë¡œ ì¶œë ¥ í¬ê¸°ë¥¼ ì¡°ì •í•  ëª©ì ìœ¼ë¡œ ì‚¬ìš©\n",
    "- ìŠ¤íŠ¸ë¼ì´ë“œ(Stride): í•„í„°ë¥¼ ì ìš©í•˜ëŠ” ìœ„ì¹˜ì˜ ê°„ê²© â†’ ìŠ¤íŠ¸ë¼ì´ë“œë¥¼ í‚¤ìš°ë©´ ì¶œë ¥ì´ ì‘ì•„ì§\n",
    "- í’€ë§: ì„¸ë¡œ, ê°€ë¡œ ë°©í–¥ì˜ ê³µê°„ì„ ì¤„ì´ëŠ” ì—°ì‚°. ìµœëŒ€ í’€ë§, í‰ê·  í’€ë§ì´ ìˆìŒ. ì´ë¯¸ì§€ ì¸ì‹ ë¶„ì•¼ì—ì„œëŠ” ë³´í†µ ìµœëŒ€ í’€ë§ì„ ì‚¬ìš©.\n",
    "\n",
    "<aside>\n",
    "ğŸ’¡\n",
    "\n",
    "3ì°¨ì›ì˜ í•©ì„±ê³± ì—°ì‚°ì—ì„  ì…ë ¥ ë°ì´í„°ì˜ ì±„ë„ ìˆ˜ì™€ í•„í„°ì˜ ì±„ë„ ìˆ˜ê°€ ê°™ì•„ì•¼ í•œë‹¤.\n",
    "\n",
    "</aside>\n",
    "\n",
    "---\n",
    "\n",
    "# CNN ê°œë…\n",
    "\n",
    "## ë¸”ë¡ìœ¼ë¡œ ìƒê°í•˜ê¸°\n",
    "\n",
    "ì±„ë„ìˆ˜ = C, ë†’ì´ = H, ë„ˆë¹„ = W, í•„í„° ë†’ì´ = FH, í•„í„° ë„ˆë¹„ = FW\n",
    "\n",
    "ì…ë ¥ ë°ì´í„°ì˜ í˜•ìƒ(C, H, W)\n",
    "\n",
    "í•„í„°(C, FH, FW)\n",
    "\n",
    "â†’ í•„í„°ê°€ 1ê°œì¼ ê²½ìš° ì¶œë ¥ ë°ì´í„°ë„ 1ê°œì„. ì¶œë ¥ ë°ì´í„° Nê°œê°€ í•„ìš”í•˜ë©´ í•„í„°ë¥¼ Nê°œë¡œ ëŠ˜ë¦¬ë©´ ë¨\n",
    "\n",
    "í•„í„° (FN, C, FH, FW)\n",
    "\n",
    "## ë°°ì¹˜ ì²˜ë¦¬\n",
    "\n",
    "Nê°œì˜ ë°ì´í„°ë¥¼ ë°°ì¹˜ì²˜ë¦¬ í•  ê²½ìš° ì…ë ¥ ë°ì´í„°ì˜ ì°¨ì›ì€ (N, C, H, W)ë¡œ ë°”ë€œ.\n",
    "\n",
    "ì¶œë ¥ ë°ì´í„°ì˜ ì°¨ì›ì€ (N, FN, OH, OW)ê°€ ë¨.\n",
    "\n",
    "ì—¬ê¸°ì„œ 4ì°¨ì› ë°ì´í„°ê°€ í•˜ë‚˜ íë¥¼ ë•Œë§ˆë‹¤ ë°ì´í„° Nê°œì— ëŒ€í•œ í•©ì„±ê³± ì—°ì‚°ì´ ì´ë£¨ì–´ì§„ë‹¤. ì¦‰, NíšŒë¶„ì˜ ì²˜ë¦¬ë¥¼ í•œë²ˆì— ìˆ˜í–‰í•œë‹¤.\n",
    "\n",
    "## im2colë¡œ ë°ì´í„° ì „ê°œí•˜ê¸°\n",
    "\n",
    "im2colì´ë€ ì…ë ¥ ë°ì´í„¸ë¥´ í•„í„°ë§(ê°€ì¤‘ì¹˜ ê³„ì‚°)í•˜ê¸° ì¢‹ê²Œ ì „ê°œí•˜ëŠ” í•¨ìˆ˜ì´ë‹¤.\n",
    "\n",
    "1. ì…ë ¥ ë°ì´í„°ì—ì„œ í•„í„°ë¥¼ ì ìš©í•˜ëŠ” ì˜ì—­(3ì°¨ì› ë¸”ë¡)ì„ í•œ ì¤„ë¡œ ëŠ˜ì–´ë†“ëŠ”ë‹¤.\n",
    "2. ì…ë ¥ ë°ì´í„°ë¥¼ ì „ê°œí•œ ë‹¤ìŒì—ëŠ” í•©ì„±ê³± ê³„ì¸µì˜ í•„í„°(ê°€ì¤‘ì¹˜)ë¥¼ 1ì—´ë¡œ ì „ê°œí•˜ê³ , ë‘ í–‰ë ¬ì˜ ê³±ì„ ê³„ì‚°í•˜ë©´ ëœë‹¤.\n",
    "3. im2colë°©ì‹ìœ¼ë¡œ ì¶œë ¥í•œ ê²°ê³¼ëŠ” 2ì°¨ì› í–‰ë ¬ì´ë‹¤. CNNì€ ë°ì´í„°ë¥¼ 4ì°¨ì› ë°°ì—´ë¡œ ì €ì¥í•˜ë¯€ë¡œ 2ì°¨ì›ì¸ ì¶œë ¥ ë°ì´í„°ë¥¼ 4ì°¨ì›ìœ¼ë¡œ ë³€í˜•(reshape)í•œë‹¤.\n",
    "\n",
    "### im2col ì‹¤ì œ ì‚¬ìš©í•´ë³´ê¸°\n",
    "\n",
    "```python\n",
    "im2col(input_data, filter_h, filter_w, stride=1, pad=0)\n",
    "```\n",
    "\n",
    "- input_data - (ë°ì´í„°ìˆ˜, ì±„ë„ìˆ˜, ë†’ì´, ë„ˆë¹„)ì˜ 4ì°¨ì› ë°°ì—´\n",
    "- filter_h - í•„í„°ì˜ ë†’ì´\n",
    "- filter_w - í•„í„°ì˜ ë„ˆë¹„\n",
    "- stride - ìŠ¤íŠ¸ë¼ì´ë“œ\n",
    "- pad - íŒ¨ë”©\n",
    "\n",
    "```python\n",
    "class Convolution:\n",
    "    def __init__(self, W, b, stride=1, pad=0):\n",
    "        self.W= W\n",
    "        self.b = b\n",
    "        self.stride = stride\n",
    "        self.pad = pad\n",
    "\n",
    "    def forward(self, x):\n",
    "        FN, C, FH, FW = self.W.shape\n",
    "        N, C, H, W = x.shape\n",
    "        # ì¶œë ¥ í¬ê¸° ê³„ì‚°\n",
    "        out_h = int(1 + (H + 2*self.pad - FH) / self.stride)\n",
    "        out_w = int(1 + (W + 2*self.pad - FW) / self.stride)\n",
    "\n",
    "\t\t\t\t# ì…ë ¥ ë°ì´í„°ë¥¼ im2colë¡œ ì „ê°œ\n",
    "        col = im2col(x, FH, FW, self.stride, self.pad)\n",
    "        # reshapeì—ì„œ ë‘ ë²ˆì¨° ì¸ìˆ˜ë¥¼ -1ë¡œ ì§€ì •í•˜ë©´ ë‹¤ì°¨ì› ë°°ì—´ì˜ ì›ì†Œ ìˆ˜ê°€ ë³€í™˜ í›„ì—ë„ ë˜‘ê°™ì´\n",
    "        # ìœ ì§€ë˜ë„ë¡ ì ì ˆíˆ ë¬¶ì–´ì¤Œ\n",
    "        col_W = self.W.reshape(FN, -1).T\n",
    "        out = np.dot(col, col_W) + self.b\n",
    "        # transposeí•¨ìˆ˜ëŠ” ë‹¤ì°¨ì› ë°°ì—´ì˜ ì¶• ìˆœì„œë¥¼ ë°”ê¿”ì£¼ëŠ” í•¨ìˆ˜ì´ë‹¤.\n",
    "        out = out.reshape(N, out_h, out_w, -1).transpose(0, 3, 1, 2)\n",
    "\n",
    "        return out\n",
    "```\n",
    "\n",
    "- (10, 3, 5, 5)í˜•ìƒì„ í•œ ë‹¤ì°¨ì› ë°°ì—´ wì˜ ì›ì†Œ ìˆ˜ëŠ” ì´ 750ê°œì´ë‹¤. ì´ ë°°ì—´ì— reshape(10, -1)ì„ í˜¸ì¶œí•˜ë©´ 750ê°œì˜ ì›ì†Œë¥¼ 10ë¬¶ìŒìœ¼ë¡œ, ì¦‰ í˜•ìƒì´ (10, 75)ì¸ ë°°ì—´ë¡œ ë§Œë“¤ì–´ ì¤€ë‹¤.\n",
    "\n",
    "## í’€ë§ ê³„ì¸µ êµ¬í˜„í•˜ê¸°\n",
    "\n",
    "```python\n",
    "class Pooling:\n",
    "    def __init__(self, pool_h, pool_w, stride=1, pad=0):\n",
    "        self.pool_h = pool_h\n",
    "        self.pool_w = pool_w\n",
    "        self.stride = stride\n",
    "        self.pad = pad\n",
    "\n",
    "    def forward(self, x):\n",
    "        N, C, H, W = x.shape\n",
    "        out_h = (H - self.pool_h) // self.stride + 1\n",
    "        out_w = (W - self.pool_w) // self.stride + 1\n",
    "\n",
    "        # ì „ê°œ (1)\n",
    "        col = im2col(x, self.pool_h, self.pool_w, self.stride, self.pad)\n",
    "        col = col.reshape(-1, self.pool_h * self.pool_w)\n",
    "\n",
    "        # ìµœëŒ“ê°’ (2)\n",
    "        # np.maxë©”ì„œë“œëŠ” ì¸ìˆ˜ë¡œ ì¶•(axis)ì„ ì§€ì •í•  ìˆ˜ ìˆëŠ”ë°, ì´ ì¸ìˆ˜ë¡œ ì§€ì •í•œ ì¶•ë§ˆë‹¤ ìµœëŒ“ê°’ì„ êµ¬í•  ìˆ˜ ìˆë‹¤.\n",
    "        # ì•„ë˜ì™€ ê°™ì€ ê²½ìš°ëŠ” ì…ë ¥ xdml 1ë²ˆì§¸ ì°¨ì›ì˜ ì¶•ë§ˆë‹¤ ìµœëŒ“ê°’ì„ êµ¬í•œë‹¤.\n",
    "        out = np.max(col, axis=1)\n",
    "\n",
    "        # ì„±í˜• (3)\n",
    "        out = out.reshape(N, out_h, out_w, C).transpose(0, 3, 1, 2)\n",
    "\n",
    "        return out\n",
    "\n",
    "```\n",
    "\n",
    "1. ì…ë ¥ ë°ì´í„°ë¥¼ im2colë¡œ ì „ê°œ\n",
    "2. í–‰ë³„ ìµœëŒ“ê°’ì„ êµ¬í•¨\n",
    "3. ì ì ˆí•œ ëª¨ì–‘ìœ¼ë¡œ ì„±í˜•\n",
    "\n",
    "---\n",
    "\n",
    "# CNN êµ¬í˜„í•˜ê¸°\n",
    "\n",
    "**[SimpleConvNet]**\n",
    "\n",
    "```python\n",
    "class SimpleConvNet:\n",
    "    def __init__(self, input_dim=(1, 28, 28), conv_param={'filter_num':30, 'filter_size':5, 'pad':0, 'stride':1}, \n",
    "                 hidden_size=100, output_size=10, weight_init_std=0.01):\n",
    "        filter_num = conv_param['filter_num']\n",
    "        filter_size = conv_param['filter_size']\n",
    "        filter_pad = conv_param['pad']\n",
    "        filter_stride = conv_param['stride']\n",
    "        input_size = input_dim[1]\n",
    "        conv_output_size = (input_size - filter_szie + 2*filter_pad) / filter_stride+1\n",
    "        pool_output_size = int(filter_num * (conv_output_size/2) * (conv_output_size/2))\n",
    "```\n",
    "\n",
    "<aside>\n",
    "ğŸ’¡\n",
    "\n",
    "í•©ì„±ê³± ê³„ì¸µì˜ í¬ê¸°ë¥¼ ë¯¸ë¦¬ ê³„ì‚°í•˜ëŠ” ì´ìœ ?\n",
    "\n",
    "</aside>\n",
    "\n",
    "1. **ë‹¤ìŒ ì¸µ(íŠ¹íˆ ì™„ì „ì—°ê²°ì¸µ, FC layer)ê³¼ ì—°ê²°í•˜ê¸° ìœ„í•´**\n",
    "\n",
    "- ì™„ì „ì—°ê²°ì¸µ(FC)ì€ ì…ë ¥ í¬ê¸°ê°€ **ê³ ì •ëœ 1ì°¨ì› ë²¡í„°**ì—¬ì•¼ í•˜ë¯€ë¡œ,\n",
    "    \n",
    "    í•©ì„±ê³±/í’€ë§ì„ ê±°ì¹œ ë’¤ **ëª‡ ê°œì˜ ë‰´ëŸ°ì´ ë‚˜ì˜¤ë‚˜(ì¶œë ¥ ì°¨ì›)** ë¥¼ ì•Œì•„ì•¼ `W`(ê°€ì¤‘ì¹˜ í–‰ë ¬)ë¥¼ ì˜¬ë°”ë¥¸ í¬ê¸°ë¡œ ì´ˆê¸°í™”í•  ìˆ˜ ìˆë‹¤.\n",
    "    \n",
    "- ì¦‰, `conv_output_size`ì™€ `pool_output_size`ë¥¼ ê³„ì‚°í•´ì•¼ **ë‹¤ìŒ ì¸µ weight shape**ë¥¼ ì •í•  ìˆ˜ ìˆë‹¤.\n",
    "- ì»¨ë³¼ë£¨ì…˜ê³¼ í’€ë§ì„ ê±°ì¹œ í›„ì˜ ì¶œë ¥ ë°ì´í„° ëª¨ì–‘ì€ `(filter_num, pool_output_height, pool_output_width)`ê°€ ë©ë‹ˆë‹¤.\n",
    "\n",
    "2. **ë©”ëª¨ë¦¬(íŒŒë¼ë¯¸í„°) ì´ˆê¸°í™”ì— í•„ìš”**\n",
    "\n",
    "- ì‹ ê²½ë§ì˜ ê° ì¸µ ê°€ì¤‘ì¹˜ëŠ” `np.random.randn(...) * std` ì´ëŸ° ì‹ìœ¼ë¡œ ì´ˆê¸°í™”í•œë‹¤.\n",
    "- ì´ë•Œ **í–‰ë ¬ í¬ê¸°**ê°€ ì •í™•íˆ ë§ì§€ ì•Šìœ¼ë©´ ì—ëŸ¬ê°€ ë‚œë‹¤.\n",
    "- ê·¸ë˜ì„œ Conv â†’ Pooling í›„ì˜ ì¶œë ¥ í¬ê¸°ë¥¼ ì •í™•íˆ ì•Œì•„ì•¼,\n",
    "    \n",
    "    `W2`(ì€ë‹‰ì¸µ), `W3`(ì¶œë ¥ì¸µ) ë“± FC ê³„ì¸µì˜ weightë¥¼ ë¯¸ë¦¬ ì˜¬ë°”ë¥¸ ì°¨ì›ìœ¼ë¡œ ì¡ì„ ìˆ˜ ìˆë‹¤.\n",
    "    \n",
    "\n",
    "3. **ì˜¤ë¥˜ ë°©ì§€ & ê°€ë…ì„±**\n",
    "\n",
    "- í•©ì„±ê³± ì¶œë ¥ í¬ê¸° ê³µì‹:(I: ì…ë ¥ í¬ê¸°, F: í•„í„° í¬ê¸°, P: íŒ¨ë”©, S: ìŠ¤íŠ¸ë¼ì´ë“œ)\n",
    "    \n",
    "    ![image.png](attachment:2aa11fcd-d34b-4cf9-81b4-ec63b91e4169:image.png)\n",
    "    \n",
    "- ì´ê±¸ ì½”ë“œ ì•ˆì—ì„œ ë°”ë¡œ ì“°ë©´ ì‹¤ìˆ˜í•˜ê¸° ì‰½ë‹¤.\n",
    "- ë”°ë¼ì„œ **ì´ˆê¸°í™” ë‹¨ê³„ì—ì„œ ë¯¸ë¦¬ í•œ ë²ˆ ê³„ì‚°í•´ ë³€ìˆ˜ë¡œ ì €ì¥**í•˜ë©´, ì´í›„ ë„¤íŠ¸ì›Œí¬ êµ¬í˜„ê³¼ ë””ë²„ê¹…ì´ í›¨ì”¬ í¸í•´ì§„ë‹¤.\n",
    "\n",
    "```python\n",
    "# ë§¤ê°œë³€ìˆ˜ ì´ˆê¸°í™” ì½”ë“œ\n",
    "        self.params = {}\n",
    "        # '\\'ëŠ” ì•„ì§ ì¤„ì´ ëë‚˜ì§€ ì•Šì•˜ë‹¤ëŠ” ì˜ë¯¸\n",
    "        self.params['W1'] = weight_init_std * \\\n",
    "                            np.random.randn(filter_num, input_dim[0], filter_size, filter_size)\n",
    "        self.params['b1'] = np.zeros(filter_num)\n",
    "        self.params['W2'] = weight_init_std * \\\n",
    "                            np.random.randn(pool_output_size, hidden_size)\n",
    "        self.params['b2'] = np.zeros(hidden_size)\n",
    "        self.params['W3'] = weight_init_std * \\\n",
    "                            np.random.randn(hidden_size, output_size)\n",
    "        self.params['b3'] = np.zeros(output_size)\n",
    "```\n",
    "\n",
    "í•™ìŠµì— í•„ìš”í•œ ë§¤ê°œë³€ìˆ˜ëŠ” 1ë²ˆì§¸ ì¸µì˜ í•©ì„±ê³± ê³„ì¸µê³¼ ë‚˜ë¨¸ì§€ ë‘ ì™„ì „ì—°ê²° ê³„ì¸ ìœ¼ì´ ê°€ì¤‘ì¹˜ì™€ í¸í–¥ì´ë‹¤.\n",
    "\n",
    "ì´ ë§¤ê°œë³€ìˆ˜ë“¤ì„ ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ paramsì— ì €ì¥í•œë‹¤.\n",
    "\n",
    "1ë²ˆì¨° ì¸µì˜ í•©ì„±ê³± ê³„ì¸µì˜ ê°€ì¤‘ì¹˜ë¥¼ W1, í¸í–¥ì„ b1ì´ë¼ëŠ” í‚¤ë¡œ ì €ì¥í•˜ê³  2ë²ˆì§¸ ì¸µì˜ ì™„ì „ì—°ê²° ê³„ì¸µì˜ ê°€ì¤‘ì¹˜ì™€ í¸í–¥ì„ W2, b2 ë§ˆì§€ë§‰ 3ë²ˆì¨° ì¸µì˜ ì™„ì „ì—°ê²° ê³„ì¸µì˜ ê°€ì¤‘ì¹˜ì™€ í¸í–¥ì„ W3ì™€ b3 í‚¤ë¡œ ê°ê° ì €ì¥\n",
    "\n",
    "```python\n",
    "# CNNì„ êµ¬ì„±í•˜ëŠ” ê³„ì¸µë“¤ ìƒì„±\n",
    "        self.layers = OrderedDict()\n",
    "        self.layers['Conv1'] = Convolution(self.params['W1'], self.params['b1'], conv_param['stride'], conv_param['pad'])\n",
    "        self.layers['Relu1'] = Relu()\n",
    "        self.layers['Affine1'] = Affine(self.params['W2'], self.params['b2'])\n",
    "        self.layers['Relu2'] = Relu()\n",
    "        self.layers['Affine2'] = Affine(self.params['W3'], self.params['b3'])\n",
    "\n",
    "        self.last_layer = SoftmaxWithLoss()\n",
    "```\n",
    "\n",
    "**[predict method] â†’ ì¶”ë¡ ì„ ìˆ˜í–‰**\n",
    "\n",
    "```python\n",
    "def predict(self, x):\n",
    "    for layer in self.layers.values():\n",
    "        x = layer.forward(x)\n",
    "    return x\n",
    "\n",
    "def loss(self, x, t):\n",
    "    y = self.predict(x)\n",
    "    return self.last_layer.forward(y, t)\n",
    "```\n",
    "\n",
    "xëŠ” ì…ë ¥ ë°ì´í„°, tëŠ” ì •ë‹µ ë ˆì´ë¸”ì´ë‹¤. ì¶”ë¡ ì„ ìˆ˜í–‰í•˜ëŠ” predicë©”ì„œë“œëŠ” ì´ˆê¸°í™” ë•Œ layersì— ì¶”ê°€í•œ ê³„ì¸µì„ ë§¨ ì•ì—ì„œë¶€í„° ì°¨ë¡€ë¡œ forwardë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©° ê·¸ ê²°ê³¼ë¥¼ ë‹¤ìŒ ê³„ì¸µì— ì „ë‹¬í•œë‹¤. ì†ì‹¤ í•¨ìˆ˜ë¥¼ êµ¬í•˜ëŠ” lossë©”ì„œë“œëŠ” preict ë©”ì„œë“œì˜ ê²°ê³¼ë¥¼ ì¸ìˆ˜ë¡œ ë§ˆì§€ë§‰ ì¸µì˜ forwardë©”ì„œë“œë¥¼ í˜¸ì¶œí•œë‹¤. ì¦‰, ì²« ê³„ì¸µë¶€í„° ë§ˆì§€ë§‰ ê³„ì¸µê¹Œì§€ forwardë¥¼ ì²˜ë¦¬í•œë‹¤.\n",
    "\n",
    "**[ì˜¤ì°¨ì—­ì „íŒŒë²•] â†’ ê¸°ìš¸ê¸° êµ¬í•˜ê¸°**\n",
    "\n",
    "```python\n",
    "def gradient(self, x, t):\n",
    "    # ìˆœì „íŒŒ\n",
    "    self.loss(x, t)\n",
    "\n",
    "    # ì—­ì „íŒŒ\n",
    "    dout = 1\n",
    "    dout = self.last_layer.backward(dout)\n",
    "\n",
    "    layers = list(self.layers.values())\n",
    "    layers.reverse()\n",
    "    for layer in layers:\n",
    "        dout = layer.backward(dout)\n",
    "\n",
    "    # ê²°ê³¼ ì €ì¥\n",
    "    grads = {}\n",
    "    grads['W1'] = self.layers['Conv1'].dW\n",
    "    grads['b1'] = self.layers['Conv1'].db\n",
    "    grads['W2'] = self.layers['Affine1'].dW\n",
    "    grads['b2'] = self.layers['Affine1'].db\n",
    "    grads['W3'] = self.layers['Affine2'].dW\n",
    "    grads['b3'] = self.layers['Affine2'].db\n",
    "\n",
    "    return grads\n",
    "```\n",
    "\n",
    "`grads` ë”•ì…”ë„ˆë¦¬ì— ê¸°ìš¸ê¸°ë¥¼ ì €ì¥\n",
    "\n",
    "# CNN ì‹œê°í™”í•˜ê¸°\n",
    "\n",
    "## 1ë²ˆì§¸ ì¸µì˜ ê°€ì¤‘ì¹˜ ì‹œê°í™”í•˜ê¸°\n",
    "\n",
    "ìœ„ì—ì„œ MNIST ë°ì´í„°ì…‹ìœ¼ë¡œ ê°„ë‹¨í•œ CNNí•™ìŠµì„ í–ˆëŠ”ë°, ê·¸ë•Œ 1ë²ˆì¨° ì¸µì˜ í•©ì„±ê³± ê³„ì¸µì˜ ê°€ì¤‘ì¹˜ëŠ” í˜•ìƒì´ (30, 1, 5, 5) ì¦‰, (í•„í„° 30ê°œ, ì±„ë„ 1ê°œ, 5x5í¬ê¸°)ì´ë‹¤.\n",
    "\n",
    "í•„í„°ê°€ 5x5ì´ê³  ì±„ë„ì´ 1ê°œë¼ëŠ” ê²ƒì€ ì´ í•„í„°ë¥¼ 1ì±„ë„ì˜ íšŒìƒ‰ì¡° ì´ë¯¸ì§€ë¡œ ì‹œê°í™”í•  ìˆ˜ ìˆë‹¤ëŠ” ëœ»ì´ë‹¤.\n",
    "\n",
    "![image.png](attachment:63e789ca-c6a8-4197-ac9f-92758579dd64:image.png)\n",
    "\n",
    "í•™ìŠµì „ í•„í„°ëŠ” ë¬´ì‘ìœ„ë¡œ ì´ˆê¸°í™”ë˜ê³  ìˆì–´ í‘ë°±ì˜ ì •ë„ì— ê·œì¹™ì„±ì´ ì—†ë‹¤. í•˜ì§€ë§Œ, í•™ìŠµì„ ë§ˆì¹œ í•„í„°ëŠ” ê·œì¹™ì„± ìˆëŠ” ì´ë¯¸ì§€ê°€ ë˜ì—ˆë‹¤. í°ìƒ‰ì—ì„œ ê²€ì€ìƒ‰ìœ¼ë¡œ ë³€í™”í•˜ëŠ” í•„í„°ì™€ ë©ì–´ë¦¬(ë¸”ë¡­blob)ê°€ ì§„ í•„í„° ë“± ê·œì¹™ì„ ë„ëŠ” í•„í„°ë¡œ ë°”ë€Œì—ˆë‹¤.\n",
    "\n",
    "ì˜¤ë¥¸ìª½ê°™ì´ ê·œì¹™ì„± ìˆëŠ” í•„í„°ëŠ” ì—ì§€(ìƒ‰ìƒì´ ë°”ë€ ê²½ê³„ì„ )ê³¼ ë¸”ë¡­(êµ­ì†Œì ìœ¼ë¡œ ë©ì–´ë¦¬ì§„ ì˜ì—­)ë“±ì„ ë³´ê³ ìˆë‹¤.\n",
    "\n",
    "## ì¸µ ê¹Šì´ì— ë”°ë¥¸ ì¶”ì¶œ ì •ë³´ ë³€í™”\n",
    "\n",
    "1ë²ˆì¨° ì¸µì˜ í•©ì„±ê³± ê³„ì¸µì—ì„œëŠ” ì—ì§€ë‚˜ ë¸”ë¡­ ë“±ì˜ ì €ìˆ˜ì¤€ ì •ë³´ê°€ ì¶”ì¶œëœë‹¤. ë°˜ë©´ ê²¹ê²¹ì´ ìŒ“ì¸ CNNì€ ê³„ì¸µì´ ê¹Šì–´ì§ˆìˆ˜ë¡ ì¶”ì¶œë˜ëŠ” ì •ë³´(ì •í™•íˆëŠ” ê°•í•˜ê²Œ ë°˜ì‘í•˜ëŠ” ë‰´ëŸ°)ëŠ” ë” ì¶”ìƒí™” ëœë‹¤.\n",
    "\n",
    "![image.png](attachment:3f169260-cc28-4ffc-bb71-e39e095d5b90:image.png)\n",
    "\n",
    "ì´ ë„¤íŠ¸ì›Œí¬ êµ¬ì¡°ëŠ” AlexNetì´ë¼ í•œë‹¤. í•©ì„±ê³± ê³„ì¸µê³¼ í’€ë§ ê³„ì¸µì„ ì—¬ëŸ¬ ê²¹ ìŒ“ê³ , ë§ˆì§€ë§‰ìœ¼ë¡œ ì™„ì „ì—°ê²° ê³„ì¸µì„ ê±°ì³ ê²°ê³¼ë¥¼ ì¶œë ¥í•˜ëŠ” êµ¬ì¡°ì´ë‹¤. ì¸µì´ ê¹Šì–´ì§€ë©´ì„œ ë” ë³µì¡í•˜ê³  ì¶”ìƒí™”ëœ ì •ë³´ê°€ ì¶”ì¶œëœë‹¤. ì²˜ìŒ ì¸µì€ ë‹¨ìˆœí•œ ì—ì§€ì— ë°˜ì‘í•˜ê³ , ì´ì–´ì„œ í…ìŠ¤ì²˜, ê·¸ë¦¬ê³  ë” ë³µì¡í•œ ì‚¬ë¬¼ì˜ ì¼ë¶€ì— ë°˜ì‘í•˜ë„ë¡ ë³€í™”í•œë‹¤.\n",
    "\n",
    "ì¦‰, ì¸µì´ ê¹Šì–´ì§€ë©´ì„œ ë‰´ëŸ°ì´ ë°˜ì‘í•˜ëŠ” ëŒ€ìƒì´ ë‹¨ìˆœí•œ ëª¨ì–‘ì—ì„œ â€˜ê³ ê¸‰â€™ì •ë³´ë¡œ ë³€í™”í•´ê°€ê³  ì´ë¥¼ ë‹¤ì‹œ ë§í•˜ë©´ ì‚¬ë¬¼ì˜ â€˜ì˜ë¯¸â€™ë¥¼ ì´í•´í•˜ë„ë¡ ë³€í™”í•˜ëŠ” ê²ƒì´ë‹¤.\n",
    "\n",
    "# ëŒ€í‘œì ì¸ CNN\n",
    "\n",
    "## LeNet\n",
    "\n",
    "![image.png](attachment:0e25ee52-62bf-475d-9131-631cead0cec0:image.png)\n",
    "\n",
    "- ì†ê¸€ì”¨ ìˆ«ìë¥¼ ì¸ì‹í•˜ëŠ” ë„¤íŠ¸ì›Œí¬ë¡œ 1998ë…„ì— ì œì•ˆë¨\n",
    "- í•©ì„±ê³± ê³„ì¸µê³¼ í’€ë§ ê³„ì¸µì„ ë°˜ë³µí•˜ê³ , ë§ˆì§€ë§‰ìœ¼ë¡œ ì™„ì „ì—°ê²° ê³„ì¸µì„ ê±°ì¹˜ë©´ì„œ ê²°ê³¼ ì¶œë ¥\n",
    "- LeNetì€ ì‹œê·¸ëª¨ì´ë“œë¥¼ í™œì„±í™” í•¨ìˆ˜ë¡œ ì‚¬ìš©\n",
    "- ì„œë¸Œìƒ˜í”Œë§ì„ í•˜ì—¬ ì¤‘ê°„ ë°ì´í„°ì˜ í¬ê¸°ë¥¼ ì¤„ì´ì§€ë§Œ í˜„ì¬ëŠ” ìµœëŒ€ í’€ë§ì´ ì£¼ë¥˜ì„\n",
    "\n",
    "## AlexNet\n",
    "\n",
    "![image.png](attachment:88ae2498-b1de-40f3-84e3-da70ae27c84e:image.png)\n",
    "\n",
    "- 2012ë…„ì— ë°œí‘œë¨\n",
    "- í•©ì„±ê³± ê³„ì¸µê³¼ í’€ë§ ê³„ì¸µì„ ê±°ë“­í•˜ë©° ë§ˆì§€ë§‰ìœ¼ë¡œ ì™„ì „ì—°ê²° ê³„ì¸µì„ ê±°ì¹¨\n",
    "- í™œì„±í™” í•¨ìˆ˜ë¥¼ ReLUë¡œ ì‚¬ìš©\n",
    "- LRN(Local Response Normalization)ì´ë¼ëŠ” êµ­ì†Œì  ì •ê·œí™” ì‹¤ì‹œí•˜ëŠ” ê³„ì¸µ ì´ìš©\n",
    "- ë“œë¡­ì•„ì›ƒ ì‚¬ìš©"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.12.7"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
